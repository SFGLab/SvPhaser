# SvPhaser

> **Haplotypeâ€‘aware structuralâ€‘variant genotyper for longâ€‘read data**

[![PyPI version](https://img.shields.io/pypi/v/svphaser.svg?logo=pypi)](https://pypi.org/project/svphaser)
[![Tests](https://img.shields.io/github/actions/workflow/status/yourâ€‘org/SvPhaser/ci.yml?label=ci)](https://github.com/yourâ€‘org/SvPhaser/actions)
[![License](https://img.shields.io/github/license/yourâ€‘org/SvPhaser.svg)](LICENSE)

---

`SvPhaser` phases **preâ€‘called structural variants (SVs)** using *HPâ€‘tagged* longâ€‘read alignments (PacBio HiFi, ONT Q20+, â€¦).  Think of it as *WhatsHap* for insertions/deletions/duplications: we do **not** discover SVs; we assign each variant a haplotype genotype (`0|1`, `1|0`, `1|1`, or `./.`) together with a **Genotype Quality (GQ)** score â€“ all in a single, embarrassinglyâ€‘parallel pass over the genome.

## Key highlights

* **Fast, perâ€‘chromosome multiprocessing** â€“ linear scaleâ€‘out on 32â€‘core workstations.
* **Deterministic Î”â€‘based decision tree** â€“ no MCMC or hidden state machines.
* **Friendly CLI** (`svphaser phase â€¦`) and importable Python API.
* **Seamless VCF injection** â€“ adds `HP_GT`, `HP_GQ`, `HP_GQBIN` INFO tags while copying the original header verbatim.
* **Configurable confidence bins** and publicationâ€‘ready plots (see `result_images/`).

---

## Installation

```bash
# Requires Python â‰¥3.9
pip install svphaser            # PyPI (coming soon)
# or
pip install git+https://github.com/yourâ€‘org/SvPhaser.git@v0.2.0
```

`cyvcf2`, `pysam`, `typer[all]`, and `pandas` are pulled in automatically.

## Quickâ€‘start

```bash
svphaser phase \
    sample_unphased.vcf.gz \
    sample.sorted_phased.bam \
    --out-dir results/ \
    --min-support 10 \
    --major-delta 0.70 \
    --equal-delta 0.25 \
    --gq-bins "30:High,10:Moderate" \
    --threads 32
```

Outputs (written inside **`results/`**)

```
sample_unphased_phased.vcf   # original VCF + HP_* INFO fields
sample_unphased_phased.csv   # tidy table for plotting / downstream R
```

See [`docs/methodology.md`](docs/methodology.md) and the flowâ€‘chart below for algorithmic details.

![SvPhaser methodology](result_images/methodology_diagram.png)

## Folder layout

```
SvPhaser/
â”œâ”€ src/svphaser/        # importable package
â”‚  â”œâ”€ cli.py            # Typer entryâ€‘point
â”‚  â”œâ”€ logging.py        # unified log setup
â”‚  â””â”€ phasing/
â”‚     â”œâ”€ algorithms.py  # core maths
â”‚     â”œâ”€ io.py          # driver & I/O
â”‚     â”œâ”€ _workers.py    # perâ€‘chrom processes
â”‚     â””â”€ types.py       # thin dataclasses
â”œâ”€ tests/               # pytest suite + mini data
â”œâ”€ docs/                # extra documentation
â”œâ”€ result_images/       # generated plots & diagrams
â””â”€ CHANGELOG.md
```

## Python usage

```python
from pathlib import Path
from svphaser.phasing.io import phase_vcf

phase_vcf(
    Path("sample.vcf.gz"),
    Path("sample.bam"),
    out_dir=Path("results"),
    min_support=10,
    major_delta=0.70,
    equal_delta=0.25,
    gq_bins="30:High,10:Moderate",
    threads=8,
)
```

The resulting `DataFrame` can be loaded from the CSV for custom analytics.




## Development & contributing

1. Clone and create a virtual env:

   ```bash
   git clone https://github.com/yourâ€‘org/SvPhaser.git && cd SvPhaser
   python -m venv .venv && source .venv/bin/activate
   pip install -e .[dev]
   ```
2. Run the testâ€‘suite & type checks:

   ```bash
   pytest -q
   mypy src/svphaser
   black --check src tests
   ```
3. Send a PR targeting the **`dev`** branch; one topic per PR.

Please read `CONTRIBUTING.md` (to come) for styleâ€‘guides and the DCO signâ€‘off.

## Citing SvPhaser

If SvPhaser contributed to your research, please cite:

```bibtex
@software{svphaser2024,
  author       = {Pranjul Mishra, Sachin Ghadak,Zelazny Lab},
  title        = {SvPhaser: haplotypeâ€‘aware SV genotyping},
  version      = {0.2.0},
  date         = {2024-06-18},
  url          = {https://github.com/yourâ€‘org/SvPhaser}
}
```




## License
`SvPhaser` is released under the MIT License â€“ see [`LICENSE`](LICENSE).





## ðŸ“¬ Contact

Developed by **Team5** (*BioAIÂ Hackathon*) â€“ SachinÂ Gadakh & PranjulÂ Mishra.

Lead contacts:
â€¢ [pranjul.mishra@proton.me](mailto:pranjul.mishra@proton.me)
â€¢ [s.gadakh@cent.uw.edu.pl](mailto:s.gadakh@cent.uw.edu.pl)

Feedback, feature requests and bug reports are all appreciated â€” feel free to open a GitHub issue or reach out by eâ€‘mail.

---

*Happy phasing!*



